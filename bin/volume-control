#!/bin/sh

# You can call this script like this:
# $ ./volumeControl.sh up
# $ ./volumeControl.sh down
# $ ./volumeControl.sh mute

# Script modified from these wonderful people:
# https://github.com/dastorm/volume-notification-dunst/blob/master/volume.sh
# https://gist.github.com/sebastiencs/5d7227f388d93374cebdf72e783fbd6a

get_volume() {
    amixer -D pulse get Master | grep '%' | head -n 1 | cut -d '[' -f 2 | cut -d '%' -f 1
}

is_mute() {
    amixer -D pulse get Master | grep '%' | grep -oE '[^ ]+$' | grep off > /dev/null
}

send_notification() {
    iconSound="$HOME/.icons/system/volume.svg"
    iconMuted="$HOME/.icons/system/volume-muted.svg"
    appName="changeVolume"

    if is_mute ; then
        dunstify -a $appName -i "$iconMuted" -r 2593 -u normal "Muted"
    else
        volume=$(get_volume)
        # Make the bar with the special character â”€ (it's not dash -)
        # https://en.wikipedia.org/wiki/Box-drawing_character
        bar=$(seq --separator="ðŸ¬‹" 0 "$((volume / 5))" | sed 's/[0-9]//g')

        # Send the notification
        dunstify -a $appName -i "$iconSound" -r 2593 -u normal "  $bar"

        # Play sound
        canberra-gtk-play -i audio-volume-change -d "changeVolume"
    fi
}

case $1 in
    up)
        # set the volume on (if it was muted)
        amixer -D pulse set Master on > /dev/null
        # up the volume (+ 5%)
        amixer -D pulse sset Master 5%+ > /dev/null
        send_notification
        ;;
    down)
        amixer -D pulse set Master on > /dev/null
        amixer -D pulse sset Master 5%- > /dev/null
        send_notification
        ;;
    mute)
        # toggle mute
        amixer -D pulse set Master 1+ toggle > /dev/null
        send_notification
        ;;
esac
